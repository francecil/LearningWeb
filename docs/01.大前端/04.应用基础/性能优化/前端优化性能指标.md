---
title: 前端优化性能指标
date: 2023-08-30 00:57:42
permalink: /pages/c6343d/
categories: 
  - 大前端
  - 应用基础
  - 性能优化
tags: 
  - 
titleTag: 笔记
---


- 指标计算：除了 FMP 需要使用 MutationObserver 模拟计算外，其他指标基本都可以通过 performance api 获取
- 注意事项：
  - 预渲染模式下，由于存在网络和 CPU 抢占情况，性能数据会偏高，指标意义不大
  - Paint 部分指标存在兼容问题，此时选用 FMP 指标代替
- 使用方式：[web-vitals](https://github.com/GoogleChrome/web-vitals)

## FP/FCP
- 定义：首次渲染时间点/首次有内容（文本，图片，SVG，canvas）渲染的时间点
> FP 的时间可视为白屏时间
- 计算方式：通过 `performance.getEntriesByType('paint')` 获取
- 注意事项：
  - safari 14.x 以下不支持，详见 [caniuse](https://caniuse.com/mdn-api_performancepainttiming)

## FMP 
- 定义：首次绘制有意义内容的时间
- 计算原则：页面结构趋于稳定。
- 计算方式：MutationObserver 监听页面结构变化，得到一个分数，分数变化最剧烈的时间点，则为 FMP

## LCP
- 定义：页面可视区域内可见的最大图像或文本块完成渲染的相对时间
- 计算方式：通过 PerformanceObserver 监听 LCP 指标，该指标可能会拿到多次，一般仅用第一次数据
```js
new PerformanceObserver((entryList) => {
    for (const entry of entryList.getEntries()) {
        console.log('LCP candidate:', entry.startTime, entry);
    }})
.observe({type: 'largest-contentful-paint', buffered: true});
```
- 注意事项：
  - safari 不支持：见 [caniuse](https://caniuse.com/mdn-api_largestcontentfulpaint)

## 拓展阅读
- [字节性能指标计算](https://www.volcengine.com/docs/6431/107445)